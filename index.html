<!DOCTYPE html>
<html>

<head>
	<title>Scratch Cloud Chat</title>
	<style>
		i {
			float: right;
		}
	</style>
</head>

<body>
	<div id="messages"></div>
	<script>
		function isBad(text) {
			return getAjax(
				'http://www.purgomalum.com/service/containsprofanity?text=' + text,
				function(data) {
					return data.response;
				}
			);
		};
		
		function getAjax(url, success) {
			var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
			xhr.open('GET', 'https://cors-everywhere.herokuapp.com/' + url.replace('http:\/\/', '').replace('https:\/\/', ''));
			xhr.onreadystatechange = function() {
				if (xhr.readyState > 3 && xhr.status == 200) success(xhr.responseText);
			};
			xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
			xhr.send();
			return xhr;
		};

		getAjax(
			'https://clouddata.scratch.mit.edu/logs?projectid=179864787&limit=50&offset=0',
			function(data) {
				obj = JSON.parse(data); //Fill up the Object with parsed data
				for (i = 0; i < obj.length - 1; i++) {
					if (!isBad(obj[i].value)) {
						document.getElementById('messages').innerHTML += '<b>' + obj[i].user + ':</b> <i>' + obj[i].value + '</i><br>';
					} else {
						document.getElementById('messages').innerHTML += '<b>' + obj[i].user + ':</b> <i>[DELETED]</i><br>';
					}
				}
				console.log(obj.length);
			}
		);
	</script>
</body>

</html>
