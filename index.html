<!DOCTYPE html>
<html>

<head>
	<title>Scratch Cloud Chat</title>
	<style>
		i {
			float: right;
		}
	</style>
</head>

<body>
	<div id="messages"></div>
	<script>
		var http = {
			// HTTP GET Request function
			get: function(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText},
			
			// HTML POST Request function WIP
			post: function(e,t,n){var o="string"==typeof t?t:Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&"),s=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return s.open("POST",e),s.onreadystatechange=function(){s.readyState>3&&200==s.status&&n(s.responseText)},s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.send(o),s}
		};
		
		function isGood(text) {
			return http.get('http://www.purgomalum.com/service/containsprofanity?text=' + text);
		};
		
		function getAjax(url, success) {
			var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');
			xhr.open('GET', 'https://cors-everywhere.herokuapp.com/' + url.replace('http:\/\/', '').replace('https:\/\/', ''));
			xhr.onreadystatechange = function() {
				if (xhr.readyState > 3 && xhr.status == 200) success(xhr.responseText);
			};
			xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');
			xhr.send();
			return xhr;
		};

		getAjax(
			'https://clouddata.scratch.mit.edu/logs?projectid=179864787&limit=50&offset=0',
			function(data) {
				obj = JSON.parse(data); //Fill up the Object with parsed data
				for (i = 0; i < obj.length - 1; i++) {
					if (isGood(obj[i].value)) {
						document.getElementById('messages').innerHTML += '<b>' + obj[i].user + ':</b> <i>' + obj[i].value + '</i><br>';
					} else {
						document.getElementById('messages').innerHTML += '<b>' + obj[i].user + ':</b> <i>[DELETED]</i><br>';
					}
				}
				console.log(isGood(obj[i].value));
			}
		);
	</script>
</body>

</html>
